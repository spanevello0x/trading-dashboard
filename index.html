<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéØ Pullback Trading Bot</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container { max-width: 1200px; margin: 0 auto; }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    header h1 {
      font-size: 2.2rem;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #00d4ff, #7b2cbf);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .wallet-link {
      display: inline-block;
      background: rgba(255,255,255,0.1);
      color: #00d4ff;
      padding: 8px 16px;
      border-radius: 8px;
      margin: 10px 0;
      text-decoration: none;
      font-family: monospace;
      font-size: 0.85rem;
      transition: background 0.2s;
    }
    .wallet-link:hover { background: rgba(255,255,255,0.2); }
    
    .status-badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .status-online { background: #00c853; color: #000; }
    .status-offline { background: #ff5252; }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 24px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .card h2 {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .big-number {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .positive { color: #00c853; }
    .negative { color: #ff5252; }
    .neutral { color: #ffd600; }
    
    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .stat-row:last-child { border-bottom: none; }
    .stat-label { color: #888; }
    .stat-value { font-weight: 600; }
    
    .prices {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    
    .price-item {
      text-align: center;
      padding: 12px 20px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      min-width: 120px;
    }
    .price-item .coin { font-size: 0.85rem; color: #888; }
    .price-item .price { font-size: 1.3rem; font-weight: 600; }
    
    .positions-table {
      width: 100%;
      border-collapse: collapse;
    }
    .positions-table th {
      text-align: left;
      padding: 12px;
      color: #888;
      font-size: 0.8rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .positions-table td {
      padding: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .side-long { 
      background: rgba(0,200,83,0.2); 
      color: #00c853;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
    }
    .side-short { 
      background: rgba(255,82,82,0.2); 
      color: #ff5252;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
    }
    
    .config-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .config-item {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }
    .config-item .label { font-size: 0.75rem; color: #888; }
    .config-item .value { font-size: 1.1rem; font-weight: 600; margin-top: 4px; }
    
    .setup-badge {
      background: linear-gradient(90deg, #00d4ff, #7b2cbf);
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.85rem;
      display: inline-block;
      margin-bottom: 12px;
    }
    
    .full-width { grid-column: 1 / -1; }
    
    .update-time {
      text-align: center;
      color: #666;
      font-size: 0.8rem;
      margin-top: 20px;
    }
    
    .loading { text-align: center; padding: 40px; color: #888; }
    
    @media (max-width: 768px) {
      header h1 { font-size: 1.6rem; }
      .big-number { font-size: 2rem; }
      .grid { grid-template-columns: 1fr; }
      .wallet-link { font-size: 0.7rem; padding: 6px 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üéØ Pullback to Swing Bot</h1>
      <p style="color: #888; margin-bottom: 8px;">Trading automatizado no Hyperliquid</p>
      <a href="https://hypurrscan.io/address/0x4FFf1187E66b66bC8E31886F2b861f951736a276#txs" 
         target="_blank" class="wallet-link">
        üìç 0x4FFf1187E66b66bC8E31886F2b861f951736a276
      </a>
      <br>
      <span id="status-badge" class="status-badge status-offline">Carregando...</span>
    </header>
    
    <div id="prices" class="prices">
      <div class="price-item"><div class="coin">BTC</div><div class="price" id="price-btc">--</div></div>
      <div class="price-item"><div class="coin">ETH</div><div class="price" id="price-eth">--</div></div>
      <div class="price-item"><div class="coin">SOL</div><div class="price" id="price-sol">--</div></div>
    </div>
    
    <div id="dashboard" class="loading">
      <p>Carregando dados do Hyperliquid...</p>
    </div>
    
    <div class="update-time" id="update-time"></div>
  </div>
  
  <script>
    const WALLET = '0x4FFf1187E66b66bC8E31886F2b861f951736a276';
    const HL_API = 'https://api.hyperliquid.xyz/info';
    
    // Bot config (static)
    const CONFIG = {
      setup: 'Pullback to Swing',
      timeframe: '5m',
      maxTrades: 5,
      maxLeverage: 5,
      positionPct: 20,
      minRR: 1.5,
      idealRR: 2,
      coins: ['BTC', 'ETH', 'SOL']
    };
    
    function formatMoney(v) { return '$' + parseFloat(v).toFixed(2); }
    function formatPrice(v) {
      const n = parseFloat(v);
      return n >= 1000 ? '$' + n.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) : '$' + n.toFixed(2);
    }
    
    async function fetchHL(type, params = {}) {
      const res = await fetch(HL_API, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ type, ...params })
      });
      return res.json();
    }
    
    async function loadData() {
      try {
        // Fetch account state and prices in parallel
        const [account, mids] = await Promise.all([
          fetchHL('clearinghouseState', { user: WALLET }),
          fetchHL('allMids')
        ]);
        
        // Update prices
        document.getElementById('price-btc').textContent = formatPrice(mids['BTC'] || 0);
        document.getElementById('price-eth').textContent = formatPrice(mids['ETH'] || 0);
        document.getElementById('price-sol').textContent = formatPrice(mids['SOL'] || 0);
        
        // Parse account
        const value = parseFloat(account.marginSummary?.accountValue || 0);
        const withdrawable = parseFloat(account.withdrawable || 0);
        const marginUsed = parseFloat(account.marginSummary?.totalMarginUsed || 0);
        const positions = account.assetPositions || [];
        
        // Update status
        document.getElementById('status-badge').className = 'status-badge status-online';
        document.getElementById('status-badge').textContent = 'üü¢ Online';
        
        // Render dashboard
        const pnlClass = value >= 15 ? 'positive' : value >= 10 ? 'neutral' : 'negative';
        
        let positionsHtml = '<p style="color: #888; text-align: center; padding: 20px;">Nenhuma posi√ß√£o aberta</p>';
        if (positions.length > 0) {
          positionsHtml = `
            <table class="positions-table">
              <thead>
                <tr>
                  <th>Ativo</th>
                  <th>Lado</th>
                  <th>Tamanho</th>
                  <th>Entrada</th>
                  <th>PnL</th>
                  <th>Leverage</th>
                </tr>
              </thead>
              <tbody>
                ${positions.map(p => {
                  const pos = p.position;
                  const size = parseFloat(pos.szi);
                  const isLong = size > 0;
                  const pnl = parseFloat(pos.unrealizedPnl || 0);
                  const lev = pos.leverage?.value || 1;
                  return `
                    <tr>
                      <td><strong>${pos.coin}</strong></td>
                      <td><span class="side-${isLong ? 'long' : 'short'}">${isLong ? 'LONG' : 'SHORT'}</span></td>
                      <td>${Math.abs(size).toFixed(4)}</td>
                      <td>${formatPrice(pos.entryPx)}</td>
                      <td class="${pnl >= 0 ? 'positive' : 'negative'}">${pnl >= 0 ? '+' : ''}${formatMoney(pnl)}</td>
                      <td>${lev}x</td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          `;
        }
        
        document.getElementById('dashboard').innerHTML = `
          <div class="grid">
            <div class="card">
              <h2>üí∞ Conta</h2>
              <div class="big-number ${pnlClass}">${formatMoney(value)}</div>
              <div class="stat-row">
                <span class="stat-label">Dispon√≠vel</span>
                <span class="stat-value">${formatMoney(withdrawable)}</span>
              </div>
              <div class="stat-row">
                <span class="stat-label">Margem Usada</span>
                <span class="stat-value">${formatMoney(marginUsed)}</span>
              </div>
              <div class="stat-row">
                <span class="stat-label">Posi√ß√µes</span>
                <span class="stat-value">${positions.length} / ${CONFIG.maxTrades}</span>
              </div>
            </div>
            
            <div class="card">
              <h2>‚öôÔ∏è Setup</h2>
              <div class="setup-badge">${CONFIG.setup}</div>
              <div class="config-grid">
                <div class="config-item">
                  <div class="label">Timeframe</div>
                  <div class="value">${CONFIG.timeframe}</div>
                </div>
                <div class="config-item">
                  <div class="label">Max Trades</div>
                  <div class="value">${CONFIG.maxTrades}</div>
                </div>
                <div class="config-item">
                  <div class="label">Alavancagem</div>
                  <div class="value">${CONFIG.maxLeverage}x</div>
                </div>
                <div class="config-item">
                  <div class="label">Por Trade</div>
                  <div class="value">${CONFIG.positionPct}%</div>
                </div>
                <div class="config-item">
                  <div class="label">RR M√≠nimo</div>
                  <div class="value">${CONFIG.minRR}:1</div>
                </div>
                <div class="config-item">
                  <div class="label">RR Ideal</div>
                  <div class="value">${CONFIG.idealRR}:1 ‚≠ê</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card full-width">
            <h2>üìà Posi√ß√µes Abertas</h2>
            ${positionsHtml}
          </div>
        `;
        
        document.getElementById('update-time').textContent = '√öltima atualiza√ß√£o: ' + new Date().toLocaleString('pt-BR');
        
      } catch (e) {
        console.error(e);
        document.getElementById('status-badge').className = 'status-badge status-offline';
        document.getElementById('status-badge').textContent = 'üî¥ Erro';
        document.getElementById('dashboard').innerHTML = `
          <div style="background: rgba(255,82,82,0.2); border: 1px solid #ff5252; padding: 20px; border-radius: 12px; text-align: center;">
            <p>‚ùå Erro ao carregar dados</p>
            <p style="color: #888; margin-top: 8px;">${e.message}</p>
          </div>
        `;
      }
    }
    
    // Load immediately and refresh every 30s
    loadData();
    setInterval(loadData, 30000);
  </script>
</body>
</html>
